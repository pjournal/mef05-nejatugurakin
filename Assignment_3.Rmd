---
title: 'Assignment 3: Netflix'
author: "Nejat Uğur AKIN"
date: "03/11/2021"
output: html_document
---
# Findings  

1. Film or movies were added mostly in recent years (2017, 2018, 2019) and when we choose the top 50 genres according to added year, we can see that international movies and the dramas are the ones that produced mostly.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r data, include = FALSE}


library(plotly)
library(dplyr)
library(ggplot2)
library(readr)
library(lubridate)
library(crayon)

setwd("/Users/nejatugurakin/Documents/DATA SCIENCE/Data Analytics Essentials/Week 4")
netflix<-read.csv("netflix_titles.csv",na.strings = c("", "NA"), stringsAsFactors =FALSE)

#stringsAsFactors-R’a yüklediğimiz veri tabanında bulunan ve 
#nümerik olmayan değişkenleri (strings) faktör değişkeni değil karakter/metin formatında aktarır.

#missing değerler yerine NA değeri basılıyor ve missing değerler böylece ayrıştırması rahat oluyor#

#her bir değişken ve açıklamasını ekledi#
values_table1 <- rbind(c('show_id', 'type', 'title', 'director', 'cast', 'country', 'date_added', 'release_year', 'rating' , 'duration', 'listed_in', 'description'), 
                       c("Unique ID for every Movie / TV Show", 
                         "Identifier - A Movie or TV Show", 
                         "Title of the Movie or TV Show", 
                         "Director of the Movie /TV Show", 
                         "Actors involved in the Movie / TV Show",
                         "Country where the movie / show was produced",
                         "Added date on Netflix",
                         "Actual release year of the Movie / TV Show",
                         "Rating type of the Movie or TV Show",
                         "Total Duration - in minutes or number of seasons",
                         "Genere",
                         "The summary description"))

#tablo halinde çıktı aldı#
fig_table1 <- plot_ly(type = 'table', columnorder = c(1,2), columnwidth = c(12,12),header = list(
    values = c('<b>VARIABLES</b><br>', '<b>DESCRIPTION</b>'),
    line = list(color = '#506784'),
    fill = list(color = '#119DFF'),
    align = c('left','center'),
    font = list(color = 'white', size = 12),
    height = 40),
  cells = list(
    values = values_table1,
    line = list(color = '#506784'),
    fill = list(color = c('#25FEFD', 'white')),
    align = c('left', 'left'),
    font = list(color = c('#506784'), size = 12),
    height = 30
  ))

netflix$rating <- as.factor(netflix$rating)
netflix$date_added <- mdy(netflix$date_added)
netflix$release_year <- as.character(netflix$release_year)
netflix$listed_in <- as.factor(netflix$listed_in)
netflix$type <- as.factor(netflix$type)


# printing the missing values by creating a new data frame
data.frame("Variable"=c(colnames(netflix)), "Missing Values"=sapply(netflix, function(x) sum(is.na(x))), row.names=NULL)

#function to find a mode
mode <- function(v) {
  uniqv <- unique(v)
  uniqv[which.max(tabulate(match(v, uniqv)))]
}
#tabulate() function in R Language is used to count the frequency of occurrence of a element in the vector.#

netflix$rating[is.na(netflix$rating)] <- mode(netflix$rating)


netflix_1=distinct(netflix, title, country, type, release_year, .keep_all = TRUE)

netflix_1$date_added_year<-year(netflix_1$date_added)

netflix_1%>%
  filter(release_year>date_added_year)
#9 kayıt#
data.frame("Variable"=c(colnames(netflix_1)), "Missing Values"=sapply(netflix_1, function(x) sum(is.na(x))), row.names=NULL)

#yayınlanma tarihi eklenme tarihinden büyük olan veri kalitesi konuları çıkarıldı#
netflix_2<-subset(netflix_1,release_year<=date_added_year)
#missing değerler eleniyordu onları dahil etmek için önce missing değerler bulundu#
netflix_3<-netflix_1%>%
  filter(is.na(netflix_1$date_added)==TRUE)
#rbind fonksiyonu ile bu kayıtlar dahil edildi#
netflix_4 <- rbind(netflix_2,netflix_3)

missing_value<-data.frame("Variable"=c(colnames(netflix_1)), "Missing Values"=sapply(netflix_4, function(x) sum(is.na(x))), row.names=NULL)

netflix_5<-netflix_4%>%
  filter(is.na(netflix_4$date_added)==FALSE)

#Top 50 genres according to date added year

netflix_5$listed_in<- as.character(netflix_5$listed_in)
netflix_5$date_added_year<-as.character(netflix_5$date_added_year)

t <- strsplit(netflix_5$listed_in, split = ", ")
count_listed_in<- data.frame(date_added_year = rep(netflix_5$date_added_year, 
                                        sapply(t, length)), 
                             listed_in = unlist(t))

count_listed_in$listed_in <- as.character(gsub(",","",count_listed_in$listed_in))

count_listed_in$listed_in<- trimws(count_listed_in$listed_in, which = c("both"))
count_listed_in$listed_in


df_count_listed_in <- count_listed_in %>% 
  group_by(date_added_year,listed_in) %>% 
  mutate(kayıt=sum(n())) %>% 
  arrange(desc(date_added_year))

df_count_listed_in2 <- df_count_listed_in %>% 
  select(date_added_year,listed_in,kayıt)%>%
  group_by(date_added_year,listed_in) %>% 
  transmute(kayıt2=sum(kayıt)) %>% 
  arrange(desc(date_added_year))

df_count_listed_in3<-distinct(df_count_listed_in2, date_added_year, listed_in, kayıt2, .keep_all = TRUE)

df_count_listed_in4<-df_count_listed_in3%>%
  arrange(desc(kayıt2))%>%head(50)

#Top 50 genres according to countries

k <- strsplit(netflix_5$country, split = ", ")

netflix_5_countries<- data.frame(listed_in = rep(netflix_5$listed_in, sapply(k, length)), country = unlist(k))

netflix_5_countries$country <- as.character(netflix_5_countries$country)



listed_in_country <- netflix_5_countries%>%na.omit(netds_countries) %>%
  group_by(country, listed_in) %>%
  summarise(count = n())%>%
  arrange(desc(count))


r <- strsplit(listed_in_country$listed_in, split = ", ")
count_listed_in2<- data.frame(country = rep(listed_in_country$country, 
                                                   sapply(r, length)), 
                             listed_in = unlist(r))

count_listed_in2$listed_in <- as.character(gsub(",","",count_listed_in2$listed_in))

count_listed_in2$listed_in<- trimws(count_listed_in2$listed_in, which = c("both"))
count_listed_in2$country<- trimws(count_listed_in2$country, which = c("both"))
count_listed_in2

df_count_listed_in_country <- count_listed_in2 %>% 
  group_by(country,listed_in) %>% 
  mutate(kayıt=sum(n())) %>% 
  arrange(desc(kayıt))

df_count_listed_in_country2 <- df_count_listed_in_country %>% 
  select(country,listed_in,kayıt)%>%
  group_by(country,listed_in) %>% 
  transmute(kayıt2=sum(kayıt)) %>% 
  arrange(country)

df_count_listed_in_country3<-distinct(df_count_listed_in_country2, country, listed_in, kayıt2, .keep_all = TRUE)

df_count_listed_in_country4<-df_count_listed_in_country3%>%
  arrange(desc(kayıt2))%>%head(50)
```


```{r echo = FALSE, results='asis'}
library(knitr)
kable(head(df_count_listed_in4))
```


```{r df-count-listed-in4, fig.align='center', out.width='100%',fig.cap='Figure 1: Top 50 Genres According to Added Year'}
ggplot(df_count_listed_in4, aes(x=date_added_year,y=kayıt2/1000, fill = listed_in)) +
  geom_bar(stat="identity",position=position_dodge()) +
  labs(title="Top 50 Genres According to Added Year",x="Added Year",
       y="Count") + theme(legend.position="bottom",plot.title = element_text(hjust = 0.5))
```

2. When we look at the films or movie produced on Netflix, we can see that United States is the first country according to the number of contents. In addition to this, while producers prefer mostly dramas and comedies in United States, producers in other countries mostly prefer international movies.


```{r echo = FALSE, results='asis'}
library(knitr)
kable(head(df_count_listed_in_country4))
```


```{r df-count-listed-incountry4, fig.align='center', out.width='100%',fig.cap='Figure 1: Top 50 Genres According to Added Year'}
ggplot(df_count_listed_in_country4, aes(x=country,y=kayıt2, fill = listed_in)) +
  geom_bar(stat="identity",position=position_dodge()) +
  labs(title="Top 50 Genres According to Country",x="Country",
       y="Count") + theme(legend.position="bottom",plot.title = element_text(hjust = 0.5)) +coord_flip()
```

# Conclusion

Producers can create movies or TV shows except dramas or movies in United States because there are too many options in there. Also for other countries, producers can produce movies or TV shows except international movies.

# References 

The references are the ones that I utilize for my work.
[Medium Post](https://medium.com/deep-learning-turkiye/exploration-of-netflix-2020-dataset-in-r-markdown-eda-b202bbaec4a) 
[GitHub link](https://github.com/ygterl/EDA-Netflix-2020-in-R/)


